name: multi_steps_env_test

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      test_type:
        description: 'æµ‹è¯•ç±»å‹'
        required: false
        default: 'é»˜è®¤æµ‹è¯•'

  # å½“ commit æ¶ˆæ¯åŒ…å«ç‰¹å®šå…³é”®è¯æ—¶è§¦å‘
  push:
    branches:
      - main

jobs:
  environment-test:
    name: ç¯å¢ƒä¿®æ”¹ä¸éªŒè¯
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'multi_steps_env_test')  # æ£€æŸ¥ commit æ¶ˆæ¯æ˜¯å¦åŒ…å«ç‰¹å®šå…³é”®è¯
    steps:
      - name: ğŸ› ï¸ åˆå§‹åŒ–ä»“åº“
        uses: actions/checkout@v4

      - name: ğŸ§¾ æ‰“å°åˆå§‹ç¯å¢ƒä¿¡æ¯
        run: |
          echo "å½“å‰ç”¨æˆ· ID: $(id -u)"
          echo "å½“å‰ç”¨æˆ·: $(whoami)"
          echo "pip è·¯å¾„: $(which pip)"
          echo "pip ç‰ˆæœ¬:"
          pip --version
          echo "ç¯å¢ƒå˜é‡:"
          env

      - name: ğŸ ä¿®æ”¹ pip å‘½ä»¤ä¸ºæ¶æ„å‘½ä»¤
        run: |
          echo 'echo "âš ï¸ æ¶æ„ pip å·²æ‰§è¡Œï¼"' > /usr/local/bin/pip
          chmod +x /usr/local/bin/pip
          echo "å·²å°† pip å‘½ä»¤ä¿®æ”¹ä¸ºæ‰“å°æ¶æ„æ¶ˆæ¯ã€‚"

      - name: ğŸ” éªŒè¯ pip ä¿®æ”¹ç»“æœ
        run: |
          echo "ä¿®æ”¹å pip è·¯å¾„: $(which pip)"
          echo "ä¿®æ”¹å pip ç‰ˆæœ¬:"
          pip --version || echo "âš ï¸ pip æ‰§è¡Œå¤±è´¥ï¼"

      - name: ğŸ§ª å°è¯•ä½¿ç”¨ pip å®‰è£…ä¾èµ–
        run: |
          pip install requests || echo "âš ï¸ pip å®‰è£…å¤±è´¥ï¼"

      - name: âœ… æµ‹è¯•å®Œæˆ
        run: echo "ğŸ‰ æµ‹è¯•å·²å®Œæˆï¼"
